# ما تبقى من البرنامج ليكتمل

هذا الملف يلخص **ما هو منفّذ فعلياً** في الكود الحالي، ثم **ما تبقى اختيارياً** لإكمال المرحلة 1 و 2. النسخ الاحتياطي من الخادم (Backup/Restore) و **RFID عبر COM** وكل IPC في Electron **تم تنفيذها**.

---

## 1. المرحلة 1 – البنية التحتية (منفّذ)

| البند | الحالة | ملاحظة |
|--------|--------|--------|
| **1.1 License Server API** | ✅ جاهز | activate، check، حد أجهزة، تخزين hash |
| **1.2 Auto-suspend** | ✅ جاهز | مهمة دورية داخل التطبيق (`schedule_subscription_checker` كل ساعة)؛ و `POST /api/licenses/suspend-expired` للاستدعاء من cron خارجي (اختياري) |
| **1.3 Hardware ID** | ✅ جاهز | في `electron-main.js`: `license:get-hardware-id` مع `node-machine-id` (و fallback من hostname/platform). الويب يستخدم `localStorage.deviceId` عند عدم وجود Desktop |
| **1.4 Sync API** | ✅ جاهز | upload/download + حل تعارضات |

---

## 2. المرحلة 2 – Desktop (Electron) (منفّذ)

| البند | الحالة | ملاحظة |
|--------|--------|--------|
| **2.1 Electron + IPC** | ✅ جاهز | `license:get-hardware-id`, `license:check`, `license:activate`, `app:check-updates`, `backup:*`, `printer:print-html`, `rfid:list-ports`, `rfid:start`, `rfid:stop`, إرسال `rfid:tag` للـ renderer |
| **2.2 قاعدة محلية** | ✅ (IndexedDB) | IndexedDB + مزامنة جاهزة. تحويل إلى SQLite يبقى خارج النطاق الحالي |
| **2.3 التحقق من الترخيص في Desktop** | ✅ جاهز | يعمل مع `get-hardware-id` من الـ main |
| **2.4 تشويش الكود** | ✅ موجود | سكربت `scripts/obfuscate-build.js` يعمل عند `OBFUSCATE_BUILD=true` (postbuild) |
| **2.5 التحديث التلقائي** | ✅ جاهز | `app:check-updates` و `autoUpdater` عند بدء التطبيق (عند التعبئة) |
| **2.6 بناء المثبّت** | ✅ أساسي | electron-builder، NSIS، أيقونة، حقوق نشر في package.json |
| **2.7 RFID** | ✅ جاهز | keyboard wedge في الويب؛ في Electron: **COM/Serial** منفّذ في main (list-ports، start، stop، rfid:tag) + واجهة في الإعدادات (تبويب RFID) لاختيار المنفذ وبدء/إيقاف القراءة، مع دمج القراءات مع `rfidScanner` لصفحات الجرد والوحدات |
| **2.8 الطباعة** | ✅ جاهز | `printer:print-html` يفتح نافذة مخفية ويستدعي `webContents.print()` |

---

## 3. ما تبقى (اختياري)

- **Cron خارجي للـ Auto-suspend:** الاستدعاء اليدوي أو المجدول لـ `POST /api/licenses/suspend-expired` (مع `X-Cron-Secret` إن وُجد). سكربت `backend/scripts/run_suspend_expired.py` جاهز للمثال.
- **تحسينات المثبّت:** إضافة/استبدال `build/icon.ico`، أو تخصيص نصوص NSIS (شعار، حقوق نشر) حسب الحاجة.
- **التشويش عند البناء للإنتاج:** تفعيل `OBFUSCATE_BUILD=true` في سكربت `dist` أو توثيق الخطوة في README/INSTALL.
- **توثيق النشر (Deploy):** فقرة قصيرة عن تشغيل Backend (uvicorn)، بناء Frontend، و(اختياري) بناء Electron ورفع التحديثات لـ generic provider.

---

## 4. ميزات إضافية (اختيارية، خارج نطاق المرحلة 1–2)

- **اختبارات آلية (Tests):** Unit/E2E للـ backend والـ frontend.
- **أمان:** مراجعة صلاحيات الـ API، حماية ملفات البيئة.
- **توثيق المستخدم:** دليل استخدام عربي/إنجليزي للمستخدم النهائي.

---

## 5. ملخص

| الفئة | الحالة |
|--------|--------|
| **Backend** | API، ترخيص، مزامنة، نسخ احتياطي، auto-suspend (داخلي + endpoint) — جاهز |
| **Frontend (ويب)** | واجهات، إعدادات، نسخ احتياطي من الخادم — جاهز |
| **Desktop (Electron)** | نافذة، preload، IPC (ترخيص، تحديث، طباعة، backup، **RFID COM**)، واجهة RFID في الإعدادات، IndexedDB + مزامنة، تشويش (env-gated)، إعداد المثبّت — جاهز |

**المتبقي الأساسي للمرحلة 1 و 2:** لا شيء. البنود المذكورة أعلاه تحت "ما تبقى (اختياري)" و "ميزات إضافية" اختيارية أو لاحقة.
